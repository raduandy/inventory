<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#ffffff">
    <title>Add Item</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üßä</text></svg>">
</head>
<body>
    <header class="main-header">
        <div class="header-content">
            <div class="header-left">
                <a th:href="@{/}" class="back-link">‚Üê</a>
                <span class="logo-icon">üßä</span>
                <h1>Add Item</h1>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="add-form-container">
            <div class="add-items-intro">
                <span>üõí</span>
                <p>What did you buy?</p>
            </div>

            <form th:action="@{/add}" method="post" th:object="${item}" class="add-form">
                
                <div class="form-section">
                    <h2>Item</h2>
                    
                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" id="name" th:field="*{name}" required 
                               placeholder="e.g., Milk, Eggs, Cheese"
                               autofocus
                               oninput="suggestCategory(this.value)">
                        <div th:if="${#fields.hasErrors('name')}" class="field-error" th:errors="*{name}"></div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="quantity">Quantity</label>
                            <input type="number" id="quantity" th:field="*{quantity}" 
                                   step="any" min="0.01" required placeholder="1">
                        </div>

                        <div class="form-group">
                            <label for="unit">Unit</label>
                            <select id="unit" th:field="*{unit}">
                                <option value="pcs">pcs</option>
                                <option value="g">g</option>
                                <option value="kg">kg</option>
                                <option value="ml">ml</option>
                                <option value="L">L</option>
                                <option value="pack">pack</option>
                                <option value="bottle">bottle</option>
                                <option value="box">box</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="location">Location</label>
                            <select id="location" th:field="*{location}">
                                <option value="fridge">üßä Fridge</option>
                                <option value="freezer">‚ùÑÔ∏è Freezer</option>
                                <option value="pantry">üóÑÔ∏è Pantry</option>
                                <option value="counter">üçå Counter</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="category">Category</label>
                            <input type="text" id="category" th:field="*{category}" 
                                   list="category-list"
                                   placeholder="e.g., Dairy, Meat"
                                   autocomplete="off">
                            <datalist id="category-list">
                                <option th:each="cat : ${categories}" th:value="${cat}"></option>
                            </datalist>
                            <small id="category-hint" class="category-hint"></small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="expirationDate">Expires on</label>
                        <input type="date" id="expirationDate" th:field="*{expirationDate}">
                        <small>Leave empty if no expiration</small>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Notes (optional)</h2>
                    
                    <div class="form-group">
                        <textarea id="notes" th:field="*{notes}" rows="2" 
                                  placeholder="Any notes..."></textarea>
                    </div>
                </div>

                <div class="form-actions">
                    <a th:href="@{/}" class="btn btn-ghost">Cancel</a>
                    <button type="submit" class="btn btn-primary">Add Item</button>
                </div>
            </form>
        </div>
    </main>

    <script th:inline="javascript">
        let debounceTimer;
        
        function suggestCategory(name) {
            clearTimeout(debounceTimer);
            
            if (!name || name.length < 2) {
                document.getElementById('category-hint').textContent = '';
                document.getElementById('category-hint').className = 'category-hint';
                return;
            }
            
            debounceTimer = setTimeout(() => {
                fetch('/api/suggest-category?name=' + encodeURIComponent(name))
                    .then(response => response.json())
                    .then(data => {
                        const hint = document.getElementById('category-hint');
                        const categoryInput = document.getElementById('category');
                        
                        if (data.category && data.category !== '') {
                            hint.textContent = 'üí° ' + data.category;
                            hint.className = 'category-hint show';
                            
                            if (categoryInput.value === '') {
                                categoryInput.value = data.category;
                            }
                        } else {
                            hint.textContent = '';
                            hint.className = 'category-hint';
                        }
                    })
                    .catch(() => {});
            }, 300);
        }
        
        // Refresh datalist
        document.getElementById('category').addEventListener('focus', function() {
            fetch('/api/categories')
                .then(response => response.json())
                .then(categories => {
                    const datalist = document.getElementById('category-list');
                    datalist.innerHTML = '';
                    categories.forEach(cat => {
                        const option = document.createElement('option');
                        option.value = cat;
                        datalist.appendChild(option);
                    });
                })
                .catch(() => {});
        });
    </script>
</body>
</html>
